<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crop Yield Prediction</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="form.css">
</head>

<body>

<header>
  <div class="nav">
      <div class="nav-icon">
          <i class="fa-solid fa-wheat-awn"></i>
          <h2>Harvestix</h2>
      </div>
      <div class="nav-items">
          <a href="index.html">Home</a>
          <a href="form.html">Predict</a>
          <a href="tips.html">Tips</a>
          <a href="about.html">About</a>
      </div>
      <div class="nav-signin" id="navUser">
          <h4><a href="login.html">Sign In</a></h4>
          <a href="login.html"><button>Get started</button></a>
      </div>
  </div>
</header>

<div class="container">
  <h1> Crop Yield Prediction Form</h1>
  <p class="subtitle">Fill in your farm details to get predictions & advice</p>

  <form id="cropForm">
    <!-- Crop Type -->
    <label for="crop">Crop Type</label>
    <select id="crop" name="crop" required>
      <option value="">-- Select Crop --</option>
      <option>Wheat</option>
      <option>Rice</option>
      <option>Maize</option>
      <option>Cotton</option>
      <option>Sugarcane</option>
      <option>Pulses</option>
    </select>

    <!-- Soil Type -->
    <label for="soil">Soil Type</label>
    <select id="soil" name="soil" required>
      <option value="">-- Select Soil --</option>
      <option>Sandy</option>
      <option>Loamy</option>
      <option>Clayey</option>
      <option>Black</option>
      <option>Red</option>
      <option>Alluvial</option>
    </select>

    <!-- Farm Size -->
    <label for="size">Farm Size (in Acres)</label>
    <input type="number" id="size" name="size" min="0.1" step="0.1" placeholder="e.g. 2.5" required>

    <!-- Water Availability -->
    <label for="water">Water Availability</label>
    <select id="water" name="water" required>
      <option value="">-- Select Water Source --</option>
      <option>Rain-fed</option>
      <option>Canal</option>
      <option>Borewell</option>
      <option>Drip Irrigation</option>
    </select>

    <!-- Fertilizer -->
    <label>Fertilizer Used?</label>
    <div class="radio-group">
      <label><input type="radio" name="fertilizer" value="Yes" required> Yes</label>
      <label><input type="radio" name="fertilizer" value="No"> No</label>
    </div>

    <!-- Pest Problem -->
    <label for="pest">Pest Problem?</label>
    <select id="pest" name="pest" required>
      <option value="">-- Select Pest Risk --</option>
      <option>None</option>
      <option>Low</option>
      <option>Medium</option>
      <option>Severe</option>
    </select>

    <!-- Weather -->
    <label for="weather">Weather Condition</label>
    <select id="weather" name="weather" required>
      <option value="">-- Select Weather --</option>
      <option>Sunny</option>
      <option>Cloudy</option>
      <option>Rainy</option>
    </select>

    <button type="submit">Predict Yield & Get Advice</button>
  </form>

  <!-- Results Section -->
  <div id="results" class="results hidden">
    <h2>ðŸ“Š Prediction Results</h2>
    <table class="results-table">
      <tr>
        <th>Yield</th>
        <td id="yield"></td>
      </tr>
      <tr>
        <th>Confidence</th>
        <td id="confidence"></td>
      </tr>
      <tr>
        <th>Fertilizer</th>
        <td id="fertilizer"></td>
      </tr>
      <tr>
        <th>Pest Risk</th>
        <td id="pest"></td>
      </tr>
      <tr>
        <th>Advice</th>
        <td>
          <ul id="advice"></ul>
        </td>
      </tr>
    </table>
  </div>


<!-- Script to connect frontend with backend -->
<script>

  const username = localStorage.getItem("username");
  if (username) {
    document.getElementById("navUser").innerHTML = `
    <h4>ðŸ‘‹ Hello, ${username}</h4>
    <button onclick="logout()">Logout</button>
    `;
  }

  function logout() {
    localStorage.removeItem("username");
    window.location.href = "index.html";
  }

  document.getElementById("cropForm").addEventListener("submit", function(event) {
    event.preventDefault();

    const formData = {
      crop: document.getElementById("crop").value,
      soil: document.getElementById("soil").value,
      size: document.getElementById("size").value,
      water: document.getElementById("water").value,
      fertilizer: document.querySelector('input[name="fertilizer"]:checked')?.value,
      pest: document.getElementById("pest").value,
      weather: document.getElementById("weather").value
    };

    fetch("http://127.0.0.1:5000/predict", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
      console.log("Backend response:", data);  // âœ… Debug check

      document.getElementById("yield").innerText = data.prediction;
      document.getElementById("confidence").innerText = data.confidence;
      document.getElementById("fertilizer").innerText = data.fertilizer_suggestion;
      document.getElementById("pest").innerText = data.pest_risk;

      let adviceList = document.getElementById("advice");
      adviceList.innerHTML = "";
      data.advice.forEach(point => {
        let li = document.createElement("li");
        li.innerText = point;
        adviceList.appendChild(li);
      });

      document.getElementById("results").classList.remove("hidden");
    })
    .catch(error => {
      console.error("Error:", error);
      alert("Something went wrong! Check backend server.");
    });
  });
</script>



</body>
</html>
